// entry/src/main/ets/pages/MusicPage.ets
type PlayMode = 'é¡ºåºæ’­æ”¾' | 'åˆ—è¡¨å¾ªç¯' | 'éšæœºæ’­æ”¾'

@Component
export default struct MusicPage {
  @State songs: string[] = [
    'è“è²å“ˆ','æœ€åä¸€å“ˆ','å¤ªç©ºæ›¼æ³¢','åŸºèœœèœœ','è·³æ¥¼åŸº','å°åº¦åŸºç±³','å“ˆé›ªå¤§å†’é™©'
  ]
  @State playingIndex: number = -1
  @State mode: PlayMode = 'é¡ºåºæ’­æ”¾'

  // â€”â€” æ’­æ”¾æ¨¡å¼åˆ‡æ¢ â€”â€”
  private nextMode(): void {
    if (this.mode === 'é¡ºåºæ’­æ”¾') this.mode = 'åˆ—è¡¨å¾ªç¯'
    else if (this.mode === 'åˆ—è¡¨å¾ªç¯') this.mode = 'éšæœºæ’­æ”¾'
    else this.mode = 'é¡ºåºæ’­æ”¾'
  }

  private playAt(i: number): void {
    this.playingIndex = i
  }

  private removeAt(i: number): void {
    this.songs.splice(i, 1)
    if (this.playingIndex === i) this.playingIndex = -1
    else if (this.playingIndex > i) this.playingIndex -= 1
  }

  private clearAll(): void {
    this.songs = []
    this.playingIndex = -1
  }

  // â€”â€” å°åœ†æŒ‰é’®ï¼šåœ¨ Builder é‡Œç›´æ¥å†™ UIï¼Œä¸ returnï¼›é€šè¿‡å‚æ•°æ§åˆ¶å³è¾¹è·ç­‰ â€”â€”
  @Builder
  CircleBtn(label: string, onTap: () => void, marginRight: number = 0) {
    Text(label)
      .fontSize(14)
      .width(28).height(28)
      .textAlign(TextAlign.Center)
      .border({ width: 1, color: '#33000000' })
      .borderRadius(14)
      .onClick(onTap)
      .margin({ right: marginRight })
  }

  build() {
    Column() {
      // æ ‡é¢˜ + å³ä¸Šè§’åŠŸèƒ½æŒ‰é’®
      Row() {
        Text('å½“å‰æ’­æ”¾åˆ—è¡¨')
          .fontSize(20).fontWeight(FontWeight.Bold)
        Text(` (${this.songs.length})`)
          .fontSize(16).fontColor('#808a8f')
        Blank()
        this.CircleBtn('â²', () => {}, 8)            // æœ€è¿‘æ’­æ”¾ï¼ˆç¤ºä¾‹ï¼‰
        this.CircleBtn('â¤', () => {}, 8)            // æ”¶è—ï¼ˆç¤ºä¾‹ï¼‰
        this.CircleBtn('âŸ³', () => this.nextMode())  // åˆ‡æ¢æ’­æ”¾æ¨¡å¼
      }
      .padding({ left: 16, right: 16, top: 12, bottom: 8 })

      // æ’­æ”¾æ¨¡å¼è¡Œ + æ¸…ç©º
      Row() {
        Row() {
          Text(this.mode).fontColor('#6b6f76').fontSize(14)
        }
        .height(32)
        .padding({ left: 12, right: 12 })
        .backgroundColor('#10000000')
        .borderRadius(16)

        Blank()

        this.CircleBtn('ğŸ—‘', () => this.clearAll())
      }
      .padding({ left: 16, right: 16, bottom: 6 })

      // â€”â€” åˆ—è¡¨ â€”â€”ï¼ˆæ•´è¡Œé“ºæ»¡ + åˆ†å‰²çº¿ï¼‰
      List({ space: 0 }) {
        ForEach(this.songs, (name: string, index: number) => {
          ListItem() {
            Column() {
              Row() {
                // å·¦ä¾§æ­Œåï¼ˆæ­£åœ¨æ’­æ”¾é«˜äº®ï¼‰
                Text(name + (this.playingIndex === index ? '  â€¢ æ­£åœ¨æ’­æ”¾' : ''))
                  .fontSize(16)
                  .fontColor(this.playingIndex === index ? '#1a73e8' : '#222')
                Blank()
                // å³ä¾§æ§åˆ¶æŒ‰é’®
                this.CircleBtn('â–¶', () => this.playAt(index), 12)
                this.CircleBtn('ğŸ—‘', () => this.removeAt(index))
              }
              .width('100%').height(48)
              .padding({ left: 16, right: 16 })
              .backgroundColor(Color.White)

              // åˆ†å‰²çº¿ï¼ˆå…¨å®½ï¼‰
              Row().width('100%').height(0.5).backgroundColor('#11000000')
            }
            .width('100%')
          }
        }, (name: string, i: number) => `${name}-${i}`)
      }
      .edgeEffect(EdgeEffect.None)
      .width('100%').height('100%')

      // åº•éƒ¨å…³é—­æŒ‰é’®ï¼ˆç¤ºä¾‹ï¼‰
      Row() {
        Text('å…³é—­').fontSize(16)
      }
      .width('100%').height(48)
      .justifyContent(FlexAlign.Center)
      .backgroundColor('#00000000')
      .onClick(() => { /* TODO: è¿”å›æˆ–éšè—å¼¹å±‚ */ })
    }
    .width('100%').height('100%')
    .backgroundColor('#f7f8fa')
  }
}
